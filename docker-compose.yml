# Docker Compose configuration for achew
# Run with: docker-compose up -d
# Stop with: docker-compose down
# Update: docker-compose pull && docker-compose up -d

services:
  achew:
    # Official achew image
    build: .
    image: achew:local
    
    # Port mapping: host:container
    # achew runs on port 8000. Only change the host port.
    ports:
      - "8000:8000"

    environment:
      # Restricts allowed local-source roots to this base path inside the container.
      # Keep this aligned with your audiobook volume mount target.
      - LOCAL_MEDIA_BASE=/media
    
    volumes:
      # Configuration files
      - ../docker-test/config:/achew/app/config
      
      # HuggingFace model cache (OPTIONAL but recommended)
      # Prevents re-downloading large ASR models after image updates
      - ../docker-test/cache:/root/.cache/huggingface/hub
      
      # Temporary audio files used during processing (OPTIONAL) 
      # Requires several GB of space and fast storage (SSD/RAM)
      # - ./temp:/tmp/achew

      # Local-source audiobook library (REQUIRED for Local Directory mode)
      # Replace the host path with your audiobook folder.
      # Must be writable if you want achew to write chapter metadata back to files.
      - ../docker-test/test-media:/media

    restart: unless-stopped
