# Docker Compose configuration for achew
# Run with: docker compose up -d
# Stop with: docker compose down
# Update: docker compose pull && docker compose up -d

services:
  achew:
    # Docker Hub image (override in .env if needed)
    image: ${ACHEW_IMAGE:-kar5yboy/achew:latest}
    container_name: achew

    # Port mapping: host:container
    # achew runs on port 8000. Only change the host port.
    ports:
      - "${ACHEW_PORT:-8000}:8000"

    environment:
      # Restricts allowed local-source roots to this base path inside the container.
      # Keep this aligned with your audiobook volume mount target.
      - LOCAL_MEDIA_BASE=${LOCAL_MEDIA_BASE:-/media}

    volumes:
      # Configuration files
      - ${ACHEW_CONFIG_DIR:-./config}:/achew/app/config

      # HuggingFace model cache (OPTIONAL but recommended)
      # Prevents re-downloading large ASR models after image updates
      - ${ACHEW_HF_CACHE_DIR:-./cache}:/root/.cache/huggingface/hub

      # Temporary audio files used during processing (OPTIONAL)
      # Requires several GB of space and fast storage (SSD/RAM)
      # - ${ACHEW_TEMP_DIR:-./temp}:/tmp/achew

      # Local-source audiobook library (REQUIRED for Local Directory mode)
      # Replace the host path with your audiobook folder.
      # Must be writable if you want chapter changes written back to source files.
      - ${ACHEW_MEDIA_DIR:-./media}:${LOCAL_MEDIA_BASE:-/media}

    restart: unless-stopped
